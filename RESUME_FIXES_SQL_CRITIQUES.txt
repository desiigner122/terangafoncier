â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    ğŸš¨ CORRECTIONS SQL CRITIQUES - RÃ‰SUMÃ‰                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“… Date: 28 Octobre 2025
â±ï¸  DurÃ©e totale: ~10 minutes
ğŸ”´ PrioritÃ©: CRITIQUE - BLOQUANT

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                         3 PROBLÃˆMES IDENTIFIÃ‰S                            â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

âŒ PROBLÃˆME 1: PGRST204 - Colonne message_type manquante
   Table: purchase_case_messages
   Impact: Messages ne s'envoient pas
   Erreur: "Could not find the 'message_type' column"

âŒ PROBLÃˆME 2: 42703 - Colonne appointment_date manquante  
   Table: calendar_appointments
   Impact: Page de suivi dossier ne charge pas
   Erreur: "column calendar_appointments.appointment_date does not exist"

âŒ PROBLÃˆME 3: RLS Policy Violation
   Bucket: storage.objects (documents)
   Impact: Upload de documents bloquÃ©
   Erreur: "new row violates row-level security policy"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                      SOLUTION EN 3 Ã‰TAPES SIMPLES                         â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

â”Œâ”€ Ã‰TAPE 1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ Migration SQL principale                                            â”‚
â”‚ Fichier: QUICK_FIX_CALENDAR_APPOINTMENTS.sql                           â”‚
â”‚ DurÃ©e: 3 minutes                                                       â”‚
â”‚                                                                         â”‚
â”‚ Actions:                                                                â”‚
â”‚ 1. Ouvrir Supabase Console â†’ SQL Editor                               â”‚
â”‚ 2. SÃ©lectionner rÃ´le: service_role âš ï¸ IMPORTANT                       â”‚
â”‚ 3. Copier/Coller contenu du fichier SQL                               â”‚
â”‚ 4. ExÃ©cuter (Ctrl+EntrÃ©e)                                             â”‚
â”‚                                                                         â”‚
â”‚ Corrige:                                                                â”‚
â”‚ âœ… Ajoute start_time dans calendar_appointments                        â”‚
â”‚ âœ… Ajoute message_type dans purchase_case_messages                     â”‚
â”‚ âœ… CrÃ©e FK constraints                                                  â”‚
â”‚ âœ… CrÃ©e indexes de performance                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ Ã‰TAPE 2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”’ Configuration RLS Policies                                          â”‚
â”‚ Fichier: FIX_RLS_POLICIES.sql                                          â”‚
â”‚ DurÃ©e: 3 minutes                                                       â”‚
â”‚                                                                         â”‚
â”‚ Actions:                                                                â”‚
â”‚ 1. Nouvelle Query dans SQL Editor                                     â”‚
â”‚ 2. RÃ´le: service_role                                                  â”‚
â”‚ 3. Copier/Coller contenu du fichier SQL                               â”‚
â”‚ 4. ExÃ©cuter (Ctrl+EntrÃ©e)                                             â”‚
â”‚ 5. âš ï¸ Ignorer erreurs sur storage.objects (normal)                    â”‚
â”‚                                                                         â”‚
â”‚ Corrige:                                                                â”‚
â”‚ âœ… RLS policies pour purchase_case_messages                            â”‚
â”‚ âœ… RLS policies pour purchase_case_documents                           â”‚
â”‚ âœ… Permissions buyer/seller dans dossiers                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ Ã‰TAPE 3 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“¦ Storage Policies (via Dashboard)                                    â”‚
â”‚ DurÃ©e: 2 minutes                                                       â”‚
â”‚                                                                         â”‚
â”‚ Actions:                                                                â”‚
â”‚ 1. Dashboard â†’ Storage â†’ Bucket "documents"                            â”‚
â”‚ 2. Onglet Policies                                                     â”‚
â”‚ 3. VÃ©rifier policy INSERT existe                                      â”‚
â”‚ 4. Si manquante, crÃ©er:                                               â”‚
â”‚    - Name: Authenticated users can upload                             â”‚
â”‚    - Command: INSERT                                                   â”‚
â”‚    - Roles: authenticated                                              â”‚
â”‚    - Definition: bucket_id = 'documents'::text                        â”‚
â”‚                                                                         â”‚
â”‚ Corrige:                                                                â”‚
â”‚ âœ… Upload de documents autorisÃ©                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                         TESTS DE VALIDATION                               â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

âœ“ Test 1: VÃ©rifier colonnes crÃ©Ã©es (SQL)
  â†’ start_time existe dans calendar_appointments
  â†’ message_type existe dans purchase_case_messages

âœ“ Test 2: Envoyer message (Frontend)
  â†’ Ouvrir dossier â†’ Onglet Messages
  â†’ Ã‰crire + Envoyer
  â†’ âœ… Pas d'erreur PGRST204 dans console (F12)

âœ“ Test 3: Uploader document (Frontend)  
  â†’ Onglet Documents â†’ Ajouter fichier
  â†’ âœ… Pas d'erreur RLS

âœ“ Test 4: Charger rendez-vous (Frontend)
  â†’ Page suivi dossier
  â†’ âœ… Pas d'erreur 42703

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                        CHECKLIST D'EXÃ‰CUTION                              â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

[ ] 1. Ã‰TAPE 1 exÃ©cutÃ©e - Migration QUICK_FIX_CALENDAR_APPOINTMENTS.sql
[ ] 2. Ã‰TAPE 2 exÃ©cutÃ©e - RLS policies FIX_RLS_POLICIES.sql
[ ] 3. Ã‰TAPE 3 exÃ©cutÃ©e - Storage policies via Dashboard
[ ] 4. Test 1 validÃ© - Colonnes start_time et message_type existent
[ ] 5. Test 2 validÃ© - Message s'envoie sans PGRST204
[ ] 6. Test 3 validÃ© - Document s'upload sans RLS error
[ ] 7. Test 4 validÃ© - Page charge sans erreur 42703
[ ] 8. Console (F12) - Aucune erreur rouge

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                         RÃ‰SULTATS ATTENDUS                                â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

AVANT les corrections:
âŒ PGRST204: Could not find 'message_type' column
âŒ 42703: column appointment_date does not exist
âŒ RLS: new row violates row-level security policy
âŒ Messages ne s'envoient pas
âŒ Documents upload bloquÃ©
âŒ Page de suivi ne charge pas

APRÃˆS les corrections:
âœ… Colonne message_type existe
âœ… Colonne start_time existe (pas appointment_date)
âœ… RLS policies configurÃ©es
âœ… Messages s'envoient correctement
âœ… Documents s'uploadent
âœ… Page de suivi charge complÃ¨tement
âœ… Console sans erreurs

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                         FICHIERS DISPONIBLES                              â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

ğŸ“„ QUICK_FIX_CALENDAR_APPOINTMENTS.sql    [âœ… PrÃªt Ã  exÃ©cuter]
   â†’ Corrige calendar_appointments + purchase_case_messages
   â†’ CrÃ©e indexes de performance

ğŸ“„ FIX_RLS_POLICIES.sql                   [âœ… PrÃªt Ã  exÃ©cuter]
   â†’ Configure RLS pour messages et documents
   â†’ Permissions buyer/seller

ğŸ“– GUIDE_EXECUTION_FIXES_CRITIQUES.md     [ğŸ“š Documentation]
   â†’ Guide dÃ©taillÃ© Ã©tape par Ã©tape
   â†’ Section dÃ©pannage complÃ¨te
   â†’ Tests de validation

ğŸ“‹ ACTION_IMMEDIATE_*.md                   [ğŸ“– Analyse]
   â†’ PGRST204_MESSAGE_TYPE.md
   â†’ FIX_CALENDAR_APPOINTMENTS.md
   â†’ Analyse dÃ©taillÃ©e des problÃ¨mes

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                          ACTION IMMÃ‰DIATE                                 â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

1. Ouvrir: https://app.supabase.com
2. Projet: terangafoncier (ndenqikcogzrkrjnlvns)
3. SQL Editor â†’ New Query
4. RÃ´le: service_role âš ï¸
5. Copier QUICK_FIX_CALENDAR_APPOINTMENTS.sql
6. ExÃ©cuter â†’ Attendre 30 secondes
7. Copier FIX_RLS_POLICIES.sql (nouvelle query)
8. ExÃ©cuter
9. Dashboard â†’ Storage â†’ Policies
10. Tester l'application

â±ï¸  Temps total: ~10 minutes
ğŸ”´ PrioritÃ©: CRITIQUE
ğŸ“Š Impact: DÃ©bloquer messages, documents, et suivi dossiers

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Pour plus de dÃ©tails, consulter:
â†’ GUIDE_EXECUTION_FIXES_CRITIQUES.md

DerniÃ¨re mise Ã  jour: 28 Octobre 2025
